{% extends "base.html" %}

{% block title %}Add Normal User - Admin Panel{% endblock %}

{% block extra_css %}
<style>
.admin-container {
    max-width: 600px;
    margin: 2rem auto;
    padding: 0 1rem;
}

.page-header {
    background: var(--white);
    padding: 2rem;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    margin-bottom: 2rem;
    text-align: center;
}

.page-title {
    color: var(--text-primary);
    margin: 0 0 0.5rem 0;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
}

.page-icon {
    font-size: 2rem;
    color: var(--primary-color);
}

.form-container {
    background: var(--white);
    padding: 2rem;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: var(--text-primary);
}

.form-label.required::after {
    content: " *";
    color: #f44336;
}

.form-control {
    width: 100%;
    padding: 1rem;
    border: 2px solid var(--border-color);
    border-radius: var(--border-radius);
    font-size: 1rem;
    transition: var(--transition);
}

.form-control:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
}

.form-help {
    font-size: 0.8rem;
    color: var(--text-secondary);
    margin-top: 0.25rem;
}

.form-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
    padding-top: 2rem;
    border-top: 1px solid var(--border-color);
    margin-top: 2rem;
}

.btn {
    padding: 1rem 2rem;
    border-radius: var(--border-radius);
    border: none;
    cursor: pointer;
    text-decoration: none;
    font-weight: 500;
    transition: var(--transition);
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-primary {
    background: var(--primary-color);
    color: var(--white);
}

.btn-primary:hover {
    background: var(--secondary-color);
    transform: translateY(-1px);
}

.btn-secondary {
    background: var(--background-color);
    color: var(--text-primary);
    border: 1px solid var(--border-color);
}

.btn-secondary:hover {
    background: var(--border-color);
}

.password-strength {
    margin-top: 0.5rem;
    padding: 0.5rem;
    border-radius: var(--border-radius);
    font-size: 0.8rem;
}

.strength-weak {
    background: #ffebee;
    color: #c62828;
}

.strength-medium {
    background: #fff3e0;
    color: #ef6c00;
}

.strength-strong {
    background: #e8f5e8;
    color: var(--primary-color);
}
</style>
{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="page-header">
        <h1 class="page-title">
            <span class="page-icon">‚ûï</span>
            Add Normal User
        </h1>
        <p>Create a new normal user account</p>
    </div>

    <div class="form-container">
        <form method="POST">
            <div class="form-group">
                <label for="email" class="form-label required">Email Address</label>
                <input type="email" id="email" name="email" class="form-control" 
                       placeholder="user@example.com" required>
                <div class="form-help">Email must be unique and valid</div>
            </div>

            <div class="form-group">
                <label for="name" class="form-label required">Full Name</label>
                <input type="text" id="name" name="name" class="form-control" 
                       placeholder="Enter full name" required maxlength="150">
            </div>

            <div class="form-group">
                <label for="password" class="form-label required">Password</label>
                <input type="password" id="password" name="password" class="form-control" 
                       placeholder="Enter secure password" required minlength="6" 
                       onkeyup="checkPasswordStrength()">
                <div id="password-strength" class="password-strength" style="display: none;"></div>
                <div class="form-help">Password must be at least 6 characters long</div>
            </div>

            <div class="form-group">
                <label for="confirm_password" class="form-label required">Confirm Password</label>
                <input type="password" id="confirm_password" name="confirm_password" class="form-control" 
                       placeholder="Confirm password" required onkeyup="checkPasswordMatch()">
                <div id="password-match" class="form-help" style="display: none;"></div>
            </div>

            <div class="form-actions">
                <a href="{{ url_for('admin_normal_users') }}" class="btn btn-secondary">
                    ‚ùå Cancel
                </a>
                <button type="submit" class="btn btn-primary" id="submit-btn">
                    ‚úÖ Create User
                </button>
            </div>
        </form>
    </div>
</div>

<script>
function checkPasswordStrength() {
    const password = document.getElementById('password').value;
    const strengthDiv = document.getElementById('password-strength');

    if (password.length === 0) {
        strengthDiv.style.display = 'none';
        return;
    }

    strengthDiv.style.display = 'block';

    let strength = 0;
    if (password.length >= 6) strength++;
    if (password.match(/[a-z]/)) strength++;
    if (password.match(/[A-Z]/)) strength++;
    if (password.match(/[0-9]/)) strength++;
    if (password.match(/[^a-zA-Z0-9]/)) strength++;

    if (strength < 2) {
        strengthDiv.className = 'password-strength strength-weak';
        strengthDiv.textContent = '‚ö†Ô∏è Weak password';
    } else if (strength < 4) {
        strengthDiv.className = 'password-strength strength-medium';
        strengthDiv.textContent = 'üî∂ Medium password';
    } else {
        strengthDiv.className = 'password-strength strength-strong';
        strengthDiv.textContent = '‚úÖ Strong password';
    }
}

function checkPasswordMatch() {
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirm_password').value;
    const matchDiv = document.getElementById('password-match');
    const submitBtn = document.getElementById('submit-btn');

    if (confirmPassword.length === 0) {
        matchDiv.style.display = 'none';
        return;
    }

    matchDiv.style.display = 'block';

    if (password === confirmPassword) {
        matchDiv.textContent = '‚úÖ Passwords match';
        matchDiv.style.color = 'var(--primary-color)';
        submitBtn.disabled = false;
    } else {
        matchDiv.textContent = '‚ùå Passwords do not match';
        matchDiv.style.color = '#c62828';
        submitBtn.disabled = true;
    }
}

// Form validation
document.querySelector('form').addEventListener('submit', function(e) {
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirm_password').value;

    if (password !== confirmPassword) {
        e.preventDefault();
        alert('Passwords do not match!');
        return false;
    }

    if (password.length < 6) {
        e.preventDefault();
        alert('Password must be at least 6 characters long!');
        return false;
    }
});
</script>
{% endblock %}